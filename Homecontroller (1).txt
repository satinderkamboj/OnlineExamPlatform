using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using BusinessLayer;


namespace MVCDemo.Controllers
{
    public class HomeController : Controller
    {
        public ActionResult Index()
        {
            Response.Write(Session["ExamName"]);
            return View();
        }



        [HttpGet]
        [ActionName("Create")]
        public ActionResult Create_Get()
        {
            
            return View();
        }

        [HttpPost]
        [ActionName("Create")]
        public ActionResult Create_Post()
        {
            Session["Score"] = 0;
            if(ModelState.IsValid)
            {
                Name name = new Name();
                UpdateModel(name);
                Session["ExamName"] = name.ExamName;
            }
            return RedirectToAction("QuizStart");
        }


        [HttpPost]
        [ActionName("QuizStart")]
        public ActionResult QuizStartPost()
        {
            if (ModelState.IsValid)
            {
                Question ques = new Question();
                UpdateModel(ques);
                if(ques.opa!=null)
                {
                    if ((ques.correct).Equals("a"))
                        Session["Score"] = Convert.ToInt32(Session["Score"]) + 1;
                }
                else if (ques.opb != null)
                {
                    if ((ques.correct).Equals("b"))
                        Session["Score"] = Convert.ToInt32(Session["Score"]) + 1;
                }
                else if (ques.opc != null)
                {
                    if ((ques.correct).Equals("c"))
                        Session["Score"] = Convert.ToInt32(Session["Score"]) + 1;
                }
                else if (ques.opd != null)
                {
                    if ((ques.correct).Equals("d"))
                        Session["Score"] = Convert.ToInt32(Session["Score"]) + 1;
                }
            }
            return RedirectToAction("QuizStart");
        }

        
        [HttpGet]
        [ActionName("QuizStart")]
        public ActionResult QuizStartGet()
        {
            if (Session["FirstVisit"] == null)
            {
                string s = (string)Session["ExamName"];
                AdminBusinessLayer adminBusinessLayer = new AdminBusinessLayer();
                List<QuestionPaper> question_papers = adminBusinessLayer.GetQuestionPapers.ToList();
                List<int> ques_id = new List<int>();
                foreach (var item in question_papers)
                {
                    if (item.qp_name == s)
                    {
                        Question quest1 = adminBusinessLayer.getQuestionById(item.q1);
                        Session["quest1"] = quest1;
                        Question quest2 = adminBusinessLayer.getQuestionById(item.q2);
                        Session["quest2"] = quest2;
                        Question quest3 = adminBusinessLayer.getQuestionById(item.q3);
                        Session["quest3"] = quest3;
                        Question quest4 = adminBusinessLayer.getQuestionById(item.q4);
                        Session["quest4"] = quest4;
                        Question quest5 = adminBusinessLayer.getQuestionById(item.q5);
                        Session["quest5"] = quest5;
                        Question quest6 = adminBusinessLayer.getQuestionById(item.q6);
                        Session["quest6"] = quest6;
                        Question quest7 = adminBusinessLayer.getQuestionById(item.q7);
                        Session["quest7"] = quest7;
                        Question quest8 = adminBusinessLayer.getQuestionById(item.q8);
                        Session["quest8"] = quest8;
                        Question quest9 = adminBusinessLayer.getQuestionById(item.q9);
                        Session["quest9"] = quest9;
                        Question quest10 = adminBusinessLayer.getQuestionById(item.q10);
                        Session["quest10"] = quest10;


                    }
                }
                Session["FirstVisit"] = "true";
                View((Question)Session["quest1"]);
            }

            else
            {
                if(Session["q2"]==null)
                {
                    Session["q2"] = "true";
                    View((Question)Session["quest2"]);
                }
                else if (Session["q3"] == null)
                {
                    Session["q3"] = "true";
                    View((Question)Session["quest3"]);
                }
                else if (Session["q4"] == null)
                {
                    Session["q4"] = "true";
                    View((Question)Session["quest4"]);
                }
                else if (Session["q5"] == null)
                {
                    Session["q5"] = "true";
                    View((Question)Session["quest5"]);
                }
                else if (Session["q6"] == null)
                {
                    Session["q6"] = "true";
                    View((Question)Session["quest6"]);
                }
                else if (Session["q7"] == null)
                {
                    Session["q7"] = "true";
                    View((Question)Session["quest7"]);
                }
                else if (Session["q8"] == null)
                {
                    Session["q8"] = "true";
                    View((Question)Session["quest8"]);
                }
                else if (Session["q9"] == null)
                {
                    Session["q9"] = "true";
                    View((Question)Session["quest9"]);
                }
                else if (Session["q10"] == null)
                {
                    Session["q10"] = "true";
                    View((Question)Session["quest10"]);
                }
                else
                {
                    return RedirectToAction("ExamEnd");
                }
            }
            return View();
        }


        public ActionResult ExamEnd()
        {
            return View();
        }
        

        public void imd()
        {
            Report rep = new Report();
            rep.us_fname = (String)Session["us_fname"];
            rep.us_id = Convert.ToInt32(Session["us_id"]);
            rep.qp_name = (string)Session["ExamName"];
            rep.marks = Convert.ToInt32(Session["Score"]);
            AdminBusinessLayer adminBusinessLayer = new AdminBusinessLayer();
            adminBusinessLayer.AddReport(rep);
        }




        public ActionResult GenerateReport()
        {
            AdminBusinessLayer adminBusinessLayer = new AdminBusinessLayer();
            List<Report> rep= adminBusinessLayer.getReportById(Convert.ToInt32(Session["us_id"])).ToList();
            return View();

        }

    }
}