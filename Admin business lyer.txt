using System;
using System.Collections.Generic;
using System.Configuration;
using System.Linq;
using System.Web;
using System.Data;
using System.Data.SqlClient;
using System.Text;
using System.Threading.Tasks;

namespace BusinessLayer
{
    public class AdminBusinessLayer
    {
        
        public IEnumerable<Question> ViewQuestions
        {
            get
            {
                string connectionString = ConfigurationManager.ConnectionStrings["DBCS"].ConnectionString;
                List<Question> employees = new List<Question>();

                using (SqlConnection con = new SqlConnection(connectionString))
                {
                    SqlCommand cmd = new SqlCommand("spViewQuestions", con);
                    cmd.CommandType = CommandType.StoredProcedure;
                    con.Open();
                    SqlDataReader rdr = cmd.ExecuteReader();
                    while (rdr.Read())
                    {
                        Question ques = new Question();
                        ques.q_id = Convert.ToInt32(rdr["q_id"]);
                        ques.q_name = rdr["q_name"].ToString();
                        ques.q_desc = rdr["q_desc"].ToString();
                        ques.difficulty = Convert.ToInt32(rdr["difficulty"]);
                        ques.topic = rdr["topic"].ToString();
                        ques.opa = rdr["opa"].ToString();
                        ques.opb = rdr["opb"].ToString();
                        ques.opc = rdr["opc"].ToString();
                        ques.opd = rdr["opd"].ToString();
                        ques.correct = rdr["correct"].ToString();

                        employees.Add(ques);
                    }
                }
                return employees;
            }
        }

        public IEnumerable<QuestionPaper> GetQuestionPapers
        {
            get
            {
                string connectionString = ConfigurationManager.ConnectionStrings["DBCS"].ConnectionString;
                List<QuestionPaper> employees = new List<QuestionPaper>();

                using (SqlConnection con = new SqlConnection(connectionString))
                {
                    SqlCommand cmd = new SqlCommand("GetQuestionPapers", con);
                    cmd.CommandType = CommandType.StoredProcedure;
                    con.Open();
                    SqlDataReader rdr = cmd.ExecuteReader();
                    while (rdr.Read())
                    {
                        QuestionPaper ques = new QuestionPaper();
                        ques.qp_id = Convert.ToInt32(rdr["qp_id"]);
                        ques.qp_name = rdr["qp_name"].ToString();
                        ques.qp_desc = rdr["qp_desc"].ToString();
                        ques.qp_date = (DateTime)(rdr["qp_date"]);
                        ques.qp_duration = Convert.ToInt32(rdr["qp_duration"]);
                        ques.q1 = Convert.ToInt32(rdr["q1"]);
                        ques.q2 = Convert.ToInt32(rdr["q2"]);
                        ques.q3 = Convert.ToInt32(rdr["q3"]);
                        ques.q4 = Convert.ToInt32(rdr["q4"]);
                        ques.q5 = Convert.ToInt32(rdr["q5"]);
                        ques.q6 = Convert.ToInt32(rdr["q6"]);
                        ques.q7 = Convert.ToInt32(rdr["q7"]);
                        ques.q8 = Convert.ToInt32(rdr["q8"]);
                        ques.q9 = Convert.ToInt32(rdr["q9"]);
                        ques.q10 = Convert.ToInt32(rdr["q10"]);
                        employees.Add(ques);
                    }
                }
                return employees;
            }
        }

        public Question getQuestionById(int q_id)
        {
            string connectionString = ConfigurationManager.ConnectionStrings["DBCS"].ConnectionString;
            Question ques = new Question();

            using (SqlConnection con = new SqlConnection(connectionString))
            {
                SqlCommand cmd = new SqlCommand("spViewQuestions", con);
                cmd.CommandType = CommandType.StoredProcedure;
                con.Open();
                SqlDataReader rdr = cmd.ExecuteReader();
                while (rdr.Read())
                {
                    if (q_id== Convert.ToInt32(rdr["q_id"]))
                    {
                        ques.q_id = Convert.ToInt32(rdr["q_id"]);
                        ques.q_name = rdr["q_name"].ToString();
                        ques.q_desc = rdr["q_desc"].ToString();
                        ques.difficulty = Convert.ToInt32(rdr["difficulty"]);
                        ques.topic = rdr["topic"].ToString();
                        ques.opa = rdr["opa"].ToString();
                        ques.opb = rdr["opb"].ToString();
                        ques.opc = rdr["opc"].ToString();
                        ques.opd = rdr["opd"].ToString();
                        ques.correct = rdr["correct"].ToString();
                    }
                    
                }
            }
            return ques;
        }






        public void AddReport(Report report)
        {
            string connectionString = ConfigurationManager.ConnectionStrings["DBOE"].ConnectionString;

            using (SqlConnection con = new SqlConnection(connectionString))
            {
                SqlCommand cmd = new SqlCommand("spAddReport", con);
                cmd.CommandType = CommandType.StoredProcedure;

                SqlParameter paramq_name = new SqlParameter();
                paramq_name.ParameterName = "@us_fname";
                paramq_name.Value = report.us_fname;
                cmd.Parameters.Add(paramq_name);

                SqlParameter paramq_desc = new SqlParameter();
                paramq_desc.ParameterName = "@us_id";
                paramq_desc.Value = report.us_id;
                cmd.Parameters.Add(paramq_desc);

                SqlParameter paramdifficulty = new SqlParameter();
                paramdifficulty.ParameterName = "@qp_name";
                paramdifficulty.Value = report.qp_name;
                cmd.Parameters.Add(paramdifficulty);

                SqlParameter paramtopic = new SqlParameter();
                paramtopic.ParameterName = "@marks";
                paramtopic.Value = report.marks;
                cmd.Parameters.Add(paramtopic);

                con.Open();
                cmd.ExecuteNonQuery();
            }
        }





        public IEnumerable<Report> getReportById(int us_id)
        {
            string connectionString = ConfigurationManager.ConnectionStrings["DBCS"].ConnectionString;
            List<Report> repList = new List<Report>();
            using (SqlConnection con = new SqlConnection(connectionString))
            {
                SqlCommand cmd = new SqlCommand("spViewReport", con);
                cmd.CommandType = CommandType.StoredProcedure;
                con.Open();
                SqlDataReader rdr = cmd.ExecuteReader();
                while (rdr.Read())
                {
                    if (us_id == Convert.ToInt32(rdr["us_id"]))
                    {
                        Report rep = new Report();
                        rep.us_id = Convert.ToInt32(rdr["us_id"]);
                        rep.us_fname = rdr["us_fname"].ToString();
                        rep.qp_name = rdr["qp_name"].ToString();
                        rep.marks = Convert.ToInt32(rdr["marks"]);
                        repList.Add(rep);
                    }

                }
            }
            return repList;
        }




    }
}
