using System;
using System.Collections.Generic;
using System.Configuration;
using System.Linq;
using System.Web;
using System.Data;
using System.Data.SqlClient;
using System.Text;
using System.Threading.Tasks;

namespace BusinessLayer
{
    public class AdminBusinessLayer
    {
        
        public IEnumerable<Question> ViewQuestions
        {
            get
            {
                string connectionString = ConfigurationManager.ConnectionStrings["DBCS"].ConnectionString;
                List<Question> employees = new List<Question>();

                using (SqlConnection con = new SqlConnection(connectionString))
                {
                    SqlCommand cmd = new SqlCommand("spViewQuestions", con);
                    cmd.CommandType = CommandType.StoredProcedure;
                    con.Open();
                    SqlDataReader rdr = cmd.ExecuteReader();
                    while (rdr.Read())
                    {
                        Question ques = new Question();
                        ques.q_id = Convert.ToInt32(rdr["q_id"]);
                        ques.q_name = rdr["q_name"].ToString();
                        ques.q_desc = rdr["q_desc"].ToString();
                        ques.difficulty = Convert.ToInt32(rdr["difficulty"]);
                        ques.topic = rdr["topic"].ToString();
                        ques.opa = rdr["opa"].ToString();
                        ques.opb = rdr["opb"].ToString();
                        ques.opc = rdr["opc"].ToString();
                        ques.opd = rdr["opd"].ToString();
                        ques.correct = rdr["correct"].ToString();

                        employees.Add(ques);
                    }
                }
                return employees;
            }
        }

        public IEnumerable<QuestionPaper> GetQuestionPapers
        {
            get
            {
                string connectionString = ConfigurationManager.ConnectionStrings["DBCS"].ConnectionString;
                List<QuestionPaper> employees = new List<QuestionPaper>();

                using (SqlConnection con = new SqlConnection(connectionString))
                {
                    SqlCommand cmd = new SqlCommand("GetQuestionPapers", con);
                    cmd.CommandType = CommandType.StoredProcedure;
                    con.Open();
                    SqlDataReader rdr = cmd.ExecuteReader();
                    while (rdr.Read())
                    {
                        QuestionPaper ques = new QuestionPaper();
                        ques.qp_id = Convert.ToInt32(rdr["qp_id"]);
                        ques.qp_name = rdr["qp_name"].ToString();
                        ques.qp_desc = rdr["qp_desc"].ToString();
                        ques.qp_date = (DateTime)(rdr["qp_date"]);
                        ques.qp_duration = Convert.ToInt32(rdr["qp_duration"]);
                        ques.q1 = Convert.ToInt32(rdr["q1"]);
                        ques.q2 = Convert.ToInt32(rdr["q2"]);
                        ques.q3 = Convert.ToInt32(rdr["q3"]);
                        ques.q4 = Convert.ToInt32(rdr["q4"]);
                        ques.q5 = Convert.ToInt32(rdr["q5"]);
                        ques.q6 = Convert.ToInt32(rdr["q6"]);
                        ques.q7 = Convert.ToInt32(rdr["q7"]);
                        ques.q8 = Convert.ToInt32(rdr["q8"]);
                        ques.q9 = Convert.ToInt32(rdr["q9"]);
                        ques.q10 = Convert.ToInt32(rdr["q10"]);
                        employees.Add(ques);
                    }
                }
                return employees;
            }
        }

        public Question getQuestionById(int q_id)
        {
            string connectionString = ConfigurationManager.ConnectionStrings["DBCS"].ConnectionString;
            Question ques = new Question();

            using (SqlConnection con = new SqlConnection(connectionString))
            {
                SqlCommand cmd = new SqlCommand("spViewQuestions", con);
                cmd.CommandType = CommandType.StoredProcedure;
                con.Open();
                SqlDataReader rdr = cmd.ExecuteReader();
                while (rdr.Read())
                {
                    if (q_id== Convert.ToInt32(rdr["q_id"]))
                    {
                        ques.q_id = Convert.ToInt32(rdr["q_id"]);
                        ques.q_name = rdr["q_name"].ToString();
                        ques.q_desc = rdr["q_desc"].ToString();
                        ques.difficulty = Convert.ToInt32(rdr["difficulty"]);
                        ques.topic = rdr["topic"].ToString();
                        ques.opa = rdr["opa"].ToString();
                        ques.opb = rdr["opb"].ToString();
                        ques.opc = rdr["opc"].ToString();
                        ques.opd = rdr["opd"].ToString();
                        ques.correct = rdr["correct"].ToString();
                    }
                    
                }
            }
            return ques;
        }

    }
}
